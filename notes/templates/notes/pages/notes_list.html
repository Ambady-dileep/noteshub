{% extends "notes/base.html" %}

{% block title %}My Notes - NotesHub{% endblock %}

{% block content %}
<div class="notes-wrapper">

    <!-- Header -->
    <div class="notes-header">
        <h2>My Notes</h2>

        <form method="GET" class="search-form">
            <input type="text" name="q" placeholder="Search notes..." value="{{ query }}" aria-label="Search notes">

            <select name="sort" onchange="this.form.submit()" aria-label="Sort notes">
                <option value="-created_at" {% if sort_by == '-created_at' %}selected{% endif %}>Newest First</option>
                <option value="created_at" {% if sort_by == 'created_at' %}selected{% endif %}>Oldest First</option>
                <option value="title" {% if sort_by == 'title' %}selected{% endif %}>Title (A-Z)</option>
                <option value="-title" {% if sort_by == '-title' %}selected{% endif %}>Title (Z-A)</option>
            </select>

            <button type="submit">Search</button>
        </form>

        <button class="add-note-btn" id="openAddNoteBtn">+ Add Note</button>
    </div>

    <!-- Notes List -->
    <div class="notes-list">
        {% if page_obj %}
            {% for note in page_obj %}
                {% include 'notes/components/note_card.html' %}
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <p>üìù No notes yet. Create your first note to get started!</p>
            </div>
        {% endif %}
    </div>

    <!-- Pagination -->
    {% if page_obj.paginator.num_pages > 1 %}
    <div class="pagination">
        {% if page_obj.has_previous %}
            <a href="?q={{ query }}&sort={{ sort_by }}&page={{ page_obj.previous_page_number }}">‚Üê Previous</a>
        {% endif %}
        <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
        {% if page_obj.has_next %}
            <a href="?q={{ query }}&sort={{ sort_by }}&page={{ page_obj.next_page_number }}">Next ‚Üí</a>
        {% endif %}
    </div>
    {% endif %}

</div>

<!-- ==================== Modals ==================== -->

<!-- View Modal -->
<div id="viewModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" id="closeViewModalBtn">&times;</span>
        <h3 id="modalTitle"></h3>
        <p id="modalContent"></p>
    </div>
</div>

<!-- Delete Modal -->
<div id="deleteModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" id="closeDeleteModalBtn">&times;</span>
        <h3>Delete Note</h3>
        <p>Are you sure you want to delete this note?</p>
        <form id="deleteForm" method="POST">
            {% csrf_token %}
            <div class="modal-actions">
                <button type="button" class="cancel-btn" id="cancelDeleteBtn">Cancel</button>
                <button type="submit" class="danger-btn">Delete</button>
            </div>
        </form>
    </div>
</div>

<!-- Add/Edit Note Modal -->
<div id="noteFormModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" id="closeNoteFormModalBtn">&times;</span>
        <h3 id="modalHeading"></h3>
        <form id="noteForm" method="POST">
            {% csrf_token %}
            <div class="form-group">
                <label for="id_title">Title</label>
                <input type="text" name="title" id="id_title" required>
            </div>
            <div class="form-group">
                <label for="id_content">Content</label>
                <textarea name="content" id="id_content" required></textarea>
            </div>
            <button type="submit" class="submit-btn" id="modalSubmitBtn">Save</button>
        </form>
    </div>
</div>

{% endblock %}
